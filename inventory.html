<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link rel="stylesheet" href="style.css"/>
  <title>ุฅุฏุฎุงู ุงูุฃุตูุงู</title>
</head>
<body>
<div class="container">
  <div class="top">
    <a class="badge" href="index.html">โฌ ุงูุฑุฆูุณูุฉ</a>
    <h2>๐ฆ ุฅุฏุฎุงู ุงูุฃุตูุงู</h2>
  </div>

  <div class="card">
    <h3>1) ุฅุถุงูุฉ ุตูู</h3>
    <div class="row">
      <input id="sku" placeholder="ุฑูู ุงูุตูู (SKU)"/>
      <input id="name" placeholder="ุงุณู ุงูููุชุฌ"/>
      <input id="price" type="number" step="0.001" placeholder="ุณุนุฑ ุงูุจูุน"/>
      <input id="unit" placeholder="ุงููุญุฏุฉ (ุญุจุฉ/ูุฑุชูู)"/>
      <button id="addP">ุฅุถุงูุฉ</button>
    </div>
  </div>

  <div class="card" style="margin-top:12px">
    <h3>2) ุฅุถุงูุฉ ูููุฉ ูุงุฑุฏุฉ</h3>
    <div class="row">
      <input id="q" placeholder="ุจุญุซ (SKU ุฃู ุงุณู)"/>
      <button id="search">ุจุญุซ</button>
      <span class="badge" id="count">โ</span>
    </div>
    <div class="row">
      <select id="productSelect"></select>
      <input id="qty" type="number" step="0.001" placeholder="ุงููููุฉ ุงููุงุฑุฏุฉ"/>
      <input id="note" placeholder="ููุงุญุธุฉ (ูุงุชูุฑุฉ/ููุฑุฏ)"/>
      <button id="addIn">ุชุณุฌูู ูุงุฑุฏ</button>
    </div>
  </div>

  <div class="card" style="margin-top:12px">
    <h3>ุงูุฃุตูุงู</h3>
    <table>
      <thead><tr><th>SKU</th><th>ุงูุงุณู</th><th>ุงูุณุนุฑ</th><th>ุงููุฎุฒูู ุงูุญุงูู</th></tr></thead>
      <tbody id="tbl"></tbody>
    </table>
  </div>
</div>

<script type="module">
import { getDB, addProduct, addStockIn, findProducts, getStockNow } from "./app.js";

let db = getDB();

function renderProducts(list){
  const sel = document.querySelector("#productSelect");
  sel.innerHTML = list.map(p => `<option value="${p.id}">${p.sku} - ${p.name}</option>`).join("");

  document.querySelector("#tbl").innerHTML = list.map(p => {
    const stock = getStockNow(db, p.id);
    return `<tr><td>${p.sku}</td><td>${p.name}</td><td>${p.price}</td><td>${stock}</td></tr>`;
  }).join("");

  document.querySelector("#count").textContent = `ุนุฏุฏ ุงููุชุงุฆุฌ: ${list.length}`;
}

function load(q=""){
  db = getDB();
  const list = findProducts(db, q);
  renderProducts(list);
}

document.querySelector("#addP").onclick = () => {
  try{
    db = getDB();
    addProduct(db, {
      sku: document.querySelector("#sku").value,
      name: document.querySelector("#name").value,
      price: document.querySelector("#price").value,
      unit: document.querySelector("#unit").value
    });
    alert("ุชูุช ุฅุถุงูุฉ ุงูุตูู");
    load();
  }catch(e){ alert(e.message); }
};

document.querySelector("#search").onclick = () => load(document.querySelector("#q").value);

document.querySelector("#addIn").onclick = () => {
  try{
    db = getDB();
    addStockIn(db, {
      productId: Number(document.querySelector("#productSelect").value),
      qty: document.querySelector("#qty").value,
      note: document.querySelector("#note").value
    });
    alert("ุชู ุชุณุฌูู ุงููุงุฑุฏ");
    load(document.querySelector("#q").value);
  }catch(e){ alert(e.message); }
};

load();
</script>
</body>
</html>
